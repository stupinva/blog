<html>
	<head>
		<meta http-equiv="Content-Type" content="plain/html; charset=UTF-8" />
		<link rel="stylesheet" href="../styles.css" type="text/css" />
		<meta name="keywords" content="cli,sntp,vlan,ntp,syslog,rsyslog,cdp,switch" />
		<meta name="author" content="Владимир Ступин" />
		<!-- 2012-02-03 -->
		<title>Краткая справка по командам коммутаторов HP ProCurve Switch 26xx</title>
	</head>
	<body>
		<p><a href="..">&larr;</a></p>

		<h1>Краткая справка по командам коммутаторов HP ProCurve Switch 26xx</h1>

		<p>Довелось немного покопаться в коммутаторах Hewlett Packard ProCurve Switch 2650 (50-портовая модель) и 2626 (26-портовая модель). Решил записать на память команды.</p>

		<p>В целом схема режимов командной строки коммутатора очень похожа на Cisco: есть привилегированный (enable) и непривилегированный режим (disable), из которого можно попасть в режим настройки (configure terminal), из которого, в свою очередь, можно попасть в режим настройки интерфейса (interface) или VLAN (vlan).</p>

		<p><i>show running-config</i> - показать текущую конфигурацию</p>

		<p><i>write memory</i> - записать текущую конфигурацию в энергонезависимую память</p>

		<p><i>configure terminal</i> - вход в режим настройки</p>

		<h2>1. Настройка IP-адреса, маршрута по умолчанию:</h2>

		<p><i>ip default-gateway 10.0.0.1</i> - задать маршрут по умолчанию (существующий заменится на указанный)</p>

		<p><i>interface vlan 1</i> - перейти в режим настройки интерфейса vlan 1</p>

		<p><i>ip address 10.0.0.2 255.255.255.0</i> - задать новый адрес и маску (на интерфейсе можно настроить несколько адресов, поэтому старые адреса не заменяются на новые)</p>

		<p><i>no ip address 192.168.0.2 255.255.255.0</i> - убрать адрес и маску</p>

		<h2>2. Настройка способов администрирования коммутатора:</h2>

		<p><i>telnet-server</i> - включить управление коммутатором через telnet</p>

		<p><i>no telnet-server</i> - отключить управление коммутатором через telnet</p>

		<p><i>crypto key generate ssh</i> - сгенерировать ключ для ssh-сервера</p>

		<p><i>ip ssh</i> - включить управление коммутатором по SSH</p>

		<p><i>crypto key zeroize ssh</i> - обнулить ключ для ssh-сервера (SSH-сервер отключится автоматически)</p>

		<p><i>web-management plaintext</i> - включить управление коммутатором по HTTP</p>

		<p><i>no web-management plaintext</i> - выключить управление коммутатором по HTTP</p>

		<p><i>web-management ssl</i> - включить управление коммутатором по HTTPS</p>

		<p><i>no web-management ssl</i> - выключить управление коммутатором по HTTPS</p>

		<h2>3. Настройка CDP:</h2>

		<p><i>cdp enable</i> - включение CDP на коммутаторе</p>

		<p><i>no cdp enable</i> - отключить CDP на коммутаторе</p>

		<p><i>cdp enable ethernet 26</i> - включить CDP на порту 26 (действует только если включен CDP на уровне всего коммутатора)</p>

		<p><i>no cdp enable ethernet 1-25</i> - отключить CDP на портах с 1 по 25 (имеет значение только если CDP включен на уровне всего коммутатора)</p>

		<p><i>show cdp</i> - просмотреть настройки CDP на устройстве</p>

		<p><i>show cdp neighbors</i> - посмотреть список соседей на всех портах в виде таблицы</p>

		<p><i>show cdp neighbors ethernet 50</i> - посмотреть список соседей на порту 50 в виде таблицы</p>

		<p><i>show cdp neighbors detail ethernet 50</i> - посмотреть список соседей на порту 50 в подробностях</p>

		<p>Примечание: В Linux есть пакет cdpr, с помощью которого можно принимать CDP-анонсы. Делается это, например, такой командой:</p>

		<pre class="console"># cdpr -d eth2</pre>

		<h2>4. Просмотр MAC-адресов на портах коммутатора:</h2>

		<p><i>show mac-address</i> - просмотреть таблицу соответствия MAC-адресов портам коммутатора</p>

		<p><i>show mac-address ehternet 1</i> - посмотреть таблицу MAC-адресов на первом порту коммутатора</p>

		<p><i>show mac-address ehternet 1-10</i> - посмотреть таблицы MAC-адресов портах коммутатора с 1 по 10</p>

		<p><i>show mac-address 00:13:d4:4e:c3:74</i> - посмотреть, через какой порт коммутатора доступен этот MAC-адрес</p>

		<h2>5. Настройка даты и времени:</h2>

		<p><i>no clock summer-time</i> - отключение автоматического перехода на зимнее/летнее время (режим Медведева)</p>

		<p><i>clock timezone gmt +6:00</i> - установка часового пояса</p>

		<p><i>clock set 09:59:00</i> - установка времени</p>

		<p><i>clock set 02/03/2012</i> - установка даты в формате месяц/число/год</p>

		<p><i>show time</i> - посмотреть время на коммутаторе</p>

		<h2>6. Настройка SNTP-клиента:</h2>

		<p>Не знал, что такое SNTP и обратился за информацией в интернет. Оказалось (<a href="http://daveva.wrytestuff.com/swa209278.htm">Differences Between NTP and SNTP</a>), что SNTP - это упрощённая версия NTP.</p>

		<p>Клиенты SNTP и серверы SNTP берут время только из одного источника. SNTP-сервер берёт время из источника точного времени (GPS или "атомные часы"), а SNTP-клиент - только с какого-то определённого сервера NTP. Для сравнения: NTP-серверы/клиенты могут учитывать время на вышестоящих и соседних серверах NTP и поддерживать синхронизацию со всеми ими, ускоряя или замедляя локальные часы.</p>

		<p><i>sntp unicast</i> - выбор метода синхронизации от указанного источника (broadcast - синхронизация по широковещательным пакетам, рассылаемым в сеть)</p>

		<p><i>sntp server 10.0.0.3</i> - сервер времени</p>

		<p><i>sntp 30</i> - периодичность синхронизации времени в секундах</p>

		<p><i>timesync sntp</i> - синхронизировать время прямо сейчас по источнику из SNTP</p>

		<h2>7. Настройка syslog-клиента:</h2>

		<p><i>logging facility user</i> - указываем средство syslog</p>

		<p><i>logging 10.0.0.4</i> - указываем IP-адрес сервера syslog</p>

		<p>К слову, включить приём сообщений по сети в rsyslog можно добавив к его файл конфигурации /etc/rsyslog.conf следующие строки:</p>

		<pre class="code">$ModLoad imudp
$UDPServerRun 514

$ModLoad imtcp
$InputTCPServerRun 514</pre>

		<p>Эти строки подключают к rsyslog модули приёма сообщений из сети по UDP и по TCP. К сожалению, на деле сообщения, принятые по TCP, почему-то не попали в syslog (tcpdump показал, что они принимаются).</p>

		<p>Для применения новых настроек rsyslog его нужно перезапустить:</p>

		<pre class="console"># /etc/init.d/rsyslog restart</pre>

		<p>Пока всё. Относительно много хорошей документации по настройке коммутаторов Hewlett Packard написала <a href="http://xgu.ru/wiki/%D0%9A%D0%B0%D1%82%D0%B5%D0%B3%D0%BE%D1%80%D0%B8%D1%8F:%D0%90%D0%B2%D1%82%D0%BE%D1%80_%D0%9D%D0%B0%D1%82%D0%B0%D1%88%D0%B0_%D0%A1%D0%B0%D0%BC%D0%BE%D0%B9%D0%BB%D0%B5%D0%BD%D0%BA%D0%BE">Наталья Самойленко на xgu.ru</a>.</p>

		<p>P.S. На следующий день нашёл компакт-диск с <a href="http://stupin.su/files/hp_procurve_switch_docs.zip">документацией на коммутаторы</a>, так что эта заметка теперь имеет мало смысла.</p>

		<p><a href="mailto:vladimir@stupin.su?subject=Краткая справка по командам коммутаторов HP ProCurve Switch 26xx">Написать автору</a></p>

		<p><a href="..">&larr;</a></p>
	</body>
</html>
