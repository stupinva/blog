<html>
	<head>
		<meta http-equiv="Content-Type" content="plain/html; charset=UTF-8" />
		<link rel="stylesheet" href="../styles.css" type="text/css" />
		<meta name="keywords" content="перевод,gpg" />
		<meta name="author" content="Владимир Ступин" />
		<!-- 2017-08-27 -->
		<title>Эндрю Бикхоф. Краткое руководство по GPG, 2013</title>
	</head>
	<body>
		<p><a href="..">&larr;</a></p>

		<h1>Эндрю Бикхоф. Краткое руководство по GPG, 2013</h1>

		<p>Перевод статьи: <a href="http://www.beekhof.net/blog/2013/gpg-quickstart">GPG Quickstart</a></p>

		<p>Автор: Эндрю Бикхоф (Andrew Beekhof)</p>

		<p>Оказалось кстати, что мне нужно было одновременно освежить знания о GPG и обновить ключи. Я собрал свой опыт (и источники) в тексте ниже, на случай если это окажется кому-то полезным:</p>

		<h2>1. Подготовка</h2>

		<p>Следующие <a href="https://we.riseup.net/riseuplabs+paow/openpgp-best-practices#update-your-gpg-defaults">настройки</a> обеспечат, чтобы все ключи, создаваемые в дальнейшем, строго соответствовали стандартам 2013 года. Поместите эти настройки в файл ~/.gnupg/gpg.conf:</p>

		<pre class="code"># Если все адресаты поддерживают несколько алгоритмов хэширования, выбирать самый надёжный из них:
personal-digest-preferences SHA512 SHA384 SHA256 SHA224
# Предпочтения для новых ключей должны учитывать приоритет алгоритмов, в соответствии с их надёжностью:
default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 BZIP2 ZLIB ZIP Uncompressed
# При создании сертификата OpenPGP использовать наиболее надёжный алгоритм хэширования,
# а не алгоритм SHA1, который используется по умолчанию:
cert-digest-algo SHA512</pre>

		<p>Следующая порция настроек не обязательна, но полезна для улучшения вывода команд gpg в различных ситуациях - в частности, для защиты от <a href="http://www.asheesh.org/note/debian/short-key-ids-are-bad-news">подделки</a>. Их тоже нужно поместить в ~/.gnupg/gpg.conf:</p>

		<pre class="code"># При выводе сертификатов показывать идентификатор пользователя, выделенный из ключей:
fixed-list-mode
# Длинные идентификаторы ключей более защищены от коллизий, чем короткие идентификаторы ключей
# (можно легко создать ключ с любым желаемым коротким идентификатором ключа):
keyid-format 0xlong
# Если вы пользуетесь графической средой (и даже если не пользуетесь ей), вам нужно использовать агента
# (похожие аргументы в пользу этого приведены по ссылке https://www.debian-administration.org/users/dkg/weblog/64):
use-agent
# Взглянув на идентификатор пользователя, вы всегда должны знать, что по мнению gpg он является доверенным,
# т.к. ключ присутствует в вашем брелоке:
verify-options show-uid-validity
list-options show-uid-validity
# Включить недвусмысленный индикатор ключа, которым сделана подпись
# (см. http://thread.gmane.org/gmane.mail.notmuch.general/3721/focus=7234):
sig-notation issuer-fpr@notations.openpgp.fifthhorseman.net=%g</pre>

		<h2>2. Создание нового ключа</h2>

		<p>Существует <a href="https://we.riseup.net/riseuplabs+paow/openpgp-best-practices#openpgp-key-checks">несколько проверок</a> для принятия решения о том, хорош ли ваш старый ключ (или ключи). Однако, если вы создали ключ больше чем пару лет назад, тогда возможно вам действительно нужен новый.</p>

		<p>Я воспользовался инструкциями из <a href="http://ekaia.org/blog/2009/05/10/creating-new-gpgkey/">статьи Анны Гереро (Ana Guerrero)</a>, которые были основой текущего <a href="http://keyring.debian.org/creating-key.html">руководства Debian</a>, но выбрал тип ключа по умолчанию в соответствии со стандартами 2013 года:</p>

		<ol>
			<li>Запустите gpg --gen-key</li>

			<li>Выберите 1: RSA и RSA (по умолчанию).</li>

			<li>Выберите размер ключа больше 2048.</li>

			<li>Задайте срок действия ключа - 2-5 лет (<a href="https://we.riseup.net/riseuplabs+paow/openpgp-best-practices#set-an-expiration-date-if-you-do-not-have-one">обоснование</a>).</li>

			<li>НЕ указывайте комментарий для идентификатора пользователя (<a href="https://www.debian-administration.org/users/dkg/weblog/97">объяснение</a>).</li>
		</ol>

		<h2>3. Добавление дополнительных идентификаторов пользователя и настройки по умолчанию</h2>

		<p>С этого момента мой брелок gpg --list-keys выглядит следующим образом:</p>

		<pre class="code">pub 4096R/0x726724204C644D83 2013-06-24
uid               [ultimate] Andrew Beekhof &lt;andrew@beekhof.net&gt;
sub 4096R/0xC88100891A418A6B 2013-06-24 [expires: 2015-06-24]</pre>

		<p>Как и у большинства людей, у меня есть несколько адресов электронной почты и я хочу использовать GPG и с ними тоже. Поэтому сейчас самое время добавить их к ключу. Для этого нужно воспользоваться командой gpg --edit-key. У Анны есть хороший пример <a href="http://ekaia.org/blog/2009/05/10/creating-new-gpgkey">добавления идентификаторов пользователей</a> и настройки предпочтений. Просто поищите в её инструкциях текст "Add other UID" - "Добавить другой идентификатор пользователя".</p>

		<h2>4. Отдельные подключи для шифрования и подписи</h2>

		<p><a href="http://stackoverflow.com/questions/5133246/what-is-the-purpose-of-using-separate-key-pairs-for-signing-and-encryption">Общепринято</a> использовать отдельные ключи для подписывания и шифрования.</p>

		<p><i>Коротко: бывает нужно что-то зашифровать, не подписывая, поскольку подписание может повлечь за собой юридически последствия. Также существует вероятность, что подписанные сообщения могут быть использованы для взлома зашифрованных данных.</i></p>

		<p>По умолчанию gpg создаёт подключ для шифрования, но я воспользуюсь <a href="http://wiki.debian.org/subkeys">руководством Debian по субключам</a>, чтобы создать ещё один для подписания (вместо того, чтобы использовать секретный мастер-ключ).</p>

		<p><i>Это позволит сделать ваш секретный мастер-ключ ещё более защищённым, избегая его повседневного использования.</i></p>

		<p>Идея заключается в том, чтобы сначала создать копию и сохранить её в ещё более безопасном месте так, что если подключ (и компьютер, где он находится) будут взломаны, мастер-ключ оставался бы в безопасности и им бы всё равно можно было бы отозвать подключи и создать новые.</p>

		<h2>5. Подписание нового ключа старым</h2>

		<p>Если ваш ключ старый, то им можно подписать новый ключ. Это даст знать всем, кто доверяет старому ключу, что новый ключ законный и поэтому ему можно доверять.</p>

		<p>Вернёмся снова <a href="http://ekaia.org/blog/2009/05/10/creating-new-gpgkey/">к советам Анны</a>. Делается это так:</p>

		<pre class="console">gpg --default-key СТАРЫЙ-КЛЮЧ --sign-key НОВЫЙ-КЛЮЧ</pre>

		<p>В моём случае команда будет такой:</p>

		<pre class="console">gpg --default-key 0xEC3584EFD449E59A --sign-key 0x726724204C644D83</pre>

		<h2>6. Отправка новых ключей на сервер</h2>

		<p>Сообщим людям, что они могут проверять вашу подпись и отправлять вам зашифрованные сообщения:</p>

		<pre class="console">gpg --send-key 0x726724204C644D83</pre>

		<h2>7. Отзыв старых идентификаторов пользователя</h2>

		<p>Как и в моём случае, вы можете перестать пользоваться каким-то из адресов электронной почты, указанных в старом ключе. Вы не можете удалить адреса из ваших ключей, но вы можете сообщить людям, чтобы они прекратили его использовать.</p>

		<p>Чтобы сделать это с моим старым ключом, я воспользуюсь инструкциями из <a href="http://lists.gnupg.org/pipermail/gnupg-users/2009-May/036425.html">списка рассылки gnupg</a>.</p>

		<p>При <a href="http://pgp.zdv.uni-mainz.de:11371/pks/lookup?op=index&amp;search=beekhof&amp;fingerprint=on">поиске</a> старого ключа всё выглядит по-прежнему:</p>

		<pre class="code">pub 1024D/D449E59A 2007-07-20 Andrew Beekhof &lt;beekhof@mac.com&gt;
                              Andrew Beekhof &lt;abeekhof@suse.de&gt;
                              Andrew Beekhof &lt;beekhof@gmail.com&gt;
                              Andrew Beekhof &lt;andrew@beekhof.net&gt;
                              Andrew Beekhof &lt;abeekhof@novell.com&gt;
        Fingerprint=E5F5 BEFC 781F 3637 774F C1F8 EC35 84EF D449 E59A</pre>

		<p>Но если заглянуть в детали ключа, можно увидеть, что адреса в Novell/SuSE в данное время отмечены красными символами revok.</p>

		<pre class="code">pub 1024D/D449E59A 2007-07-20
        Fingerprint=E5F5 BEFC 781F 3637 774F C1F8 EC35 84EF D449 E59A

uid Andrew Beekhof &lt;beekhof@mac.com&gt;
sig  sig3 D449E59A 2007-07-20 __________ __________ [selfsig]

uid Andrew Beekhof &lt;abeekhof@suse.de&gt;
sig  sig3 D449E59A 2007-07-20 __________ __________ [selfsig]
sig revok D449E59A 2013-06-24 __________ __________ [selfsig]
...</pre>

		<p>Таким образом другие люди, имеющие копию gpg, узнают, что больше не нужно использовать этот адрес. Вот почему важно периодически обновлять свои ключи.</p>

		<h2>8. Отзыв старых ключей</h2>

		<p>В реальности вы вряд ли захотите, чтобы люди, использующие старые и потенциально взломанные ключи, продолжали слать вам деликатные сообщения. Поэтому лучше <a href="http://www.hackdiary.com/2004/01/18/revoking-a-gpg-key/">отозвать весь ключ</a>.</p>

		<p>Поскольку ключи не могут быть удалены после того, как были загружены на сервер, на самом деле мы обновим существующую запись. Чтобы сделать это, нам понадобится исходный секретный ключ - поэтому держите его в безопасном месте!</p>

		<p>Некоторые люди советуют заранее создать отзыв ключа, однако лично мне это кажется просто ещё одной сущностью, за которой нужно постоянно следить.</p>

		<p>Осиротевшие ключи, которые не могут быть отозваны, продолжают оставаться действующими для любого, кто захочет отправить вам защищённое сообщение - хорошая причина задать более раннюю дату окончания действия ключа!</p>

		<p>Вот как выглядит один из моих старых отозванных ключей:</p>

		<pre class="code">pub 1024D/DABA170E 2004-10-11 *** KEY REVOKED *** [not verified]
                              Andrew Beekhof (SuSE VPN Access) &lt;andrew@beekhof.net&gt;
        Fingerprint=9A53 9DBB CF73 AB8F B57B 730A 3279 4AE9 DABA 170E</pre>

		<h2>9. Конечный результат</h2>

		<p>Мой <a href="http://pgp.zdv.uni-mainz.de:11371/pks/lookup?op=vindex&amp;fingerprint=on&amp;search=0x726724204C644D83">новый ключ</a>:</p>

		<pre class="code">pub 4096R/4C644D83 2013-06-24 Andrew Beekhof &lt;andrew@beekhof.net&gt;
                              Andrew Beekhof &lt;beekhof@mac.com&gt;
                              Andrew Beekhof &lt;abeekhof@redhat.com&gt;
Fingerprint=C503 7BA2 D013 6342 44C0 122C 7267 2420 4C64 4D83</pre>

		<h2>10. Заключение</h2>

		<p>Я не специалист по этой теме, поэтому буду очень признателен, если вы сообщите мне о любых возможных ошибках в этой статье.</p>

		<p><a href="mailto:vladimir@stupin.su?subject=Эндрю Бикхоф. Краткое руководство по GPG, 2013">Написать автору перевода</a></p>

		<p><a href="..">&larr;</a></p>
	</body>
</html>
