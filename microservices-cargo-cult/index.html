<html>
	<head>
		<meta http-equiv="Content-Type" content="plain/html; charset=UTF-8" />
		<link rel="stylesheet" href="../styles.css" type="text/css" />
		<meta name="keywords" content="микросервисы,перевод" />
		<meta name="author" content="Владимир Ступин" />
		<!-- 2017-08-13 -->
		<title>Ставрос Корокитакис. Карго-культ микросервисов, 2015</title>
	</head>
	<body>
		<p><a href="..">&larr;</a></p>

		<h1>Ставрос Корокитакис. Карго-культ микросервисов, 2015</h1>

		<p>Перевод статьи: <a href="https://www.stavros.io/posts/microservices-cargo-cult/">The microservices cargo cult</a></p>

		<p>Автор: Ставрос Корокитакис (Stavros Korokithakis)</p>

		<p>"Всё сделано правильно. Форма совершенна. Он выглядит точно так же, как и раньше. Но он не работает."</p>

		<p>Микросервисы - это чудо. Мы знаем это, потому что об этом говорят <a href="http://tech.gilt.com/2013/10/25/gilts-kevin-scaldeferri-on-enabling-micro-service">все</a> <a href="http://www.zdnet.com/article/soa-done-right-the-amazon-strategy/">последние</a> <a href="http://philcalcado.com/2015/09/08/how_we_ended_up_with_microservices.html">истории успеха</a>. Новости наполнены историями о том, как люди берут огромную монолитную систему, разбивают её, добавляют веб-API и наслаждаются всеми выгодами.</p>

		<p>Как и со всеми модными практиками, всё начинается довольно невинно. Кто-то пробует её, она хорошо себя показывает. Затем он в красках расписывает все преимущества новой практики. Все воодушевлены и хотят её попробовать. Вскоре появляется бурный поток статей, рассказывающий о том, как хорошо работает новая практика, как много людей попробовали её и убедились в её достоинствах. Однако, никто не рассказывает о тех случаях, когда она не сработала, просто потому что люди не любят рассказывать о собственных неудачах.</p>

		<p>Прежде чем продолжить, я хочу разъяснить, что я не заявляю о том, что микросервисы не работают. Как и везде, есть достоинства и недостатки, поэтому я хочу рассказать о недостатках, потому что достоинства уже достаточно освещены.</p>

		<h2>1. Карго-культы</h2>

		<p>Возможно раньше вы слышали фразу "<a href="https://ru.wikipedia.org/wiki/%D0%9A%D0%B0%D1%80%D0%B3%D0%BE-%D0%BA%D1%83%D0%BB%D1%8C%D1%82">карго-культ</a>". Эта метафора означает попытки достичь успеха, повторяя действия других успешных людей, даже если эти действия никак не ведут к успеху или недостаточны для его достижения.</p>

		<p>В данном контексте это означает реализацию микросервисов лишь потому, что все крутые ребята делают так, независимо от того, было ли это уместно и независимо от того, действительно ли успех дела зависел в первую очередь от микросервисов. Как и в случае с другими инструментами, неплохо знать сильные и слабые стороны микросервисов, прежде чем пытаться их использовать.</p>

		<h2>2. Достоинства</h2>

		<p>Давайте начнём с рассмотрения достоинств.</p>

		<ul>
			<li>
				<p><b>Масштабируемость:</b> Это главное. Поскольку микросервисы малы и самодостаточны, их можно разместить на выделенном сервере, если это будет необходимо. Можно поделить данные между экземплярами, распределять между ними нагрузку и настраивать любым способом, который имеет значение для вашего приложения.</p>

				<p>Вы также можете принять решение хранить данные в каждом из сервисов, воспользовавшись таким хранилищем данных (и даже языком программирования или технологией), которое лучше подходит в данном конкретном случае.</p>
			</li>

			<li><b>Более понятная архитектура:</b> Каждый сервис имеет чётко определённые границы, которые обычно неприкосновенны. Больше нельзя обращаться к приватным данным лишь потому, что это удобно. Каждый сервис теперь скрывается за собственным API и не доступен иным образом.</li>

			<li><b>Независимое развёртывание:</b> Поскольку каждый сервис отделён, при необходимости его легко можно развернуть даже несколько раз за день. Это может способствовать увеличению времени бесперебойной работы.</li>

			<li><b>Меньшая кодовая база:</b> Поскольку код небольшой, в нём проще разобраться. Назначение каждого сервиса и его интерфейс чётко определены, что позволяет кому-нибудь быстрее прочитать код и разобраться в нём, а стало быть - быстрее изменять, расширять и поддерживать его.</li>
		</ul>

		<h2>3. Недостатки</h2>

		<ul>
			<li>
				<p><b>Сложность:</b> Сразу на порядок увеличивается количество работы, выполняемой серверами. Между ними появляются промежуточные прослойки, работающие через сеть, что на порядок увеличивает общее количество развёртываний и нагрузку на администраторов, а количество сервисов, требующих мониторинга, увеличивается во много десятков раз.</p>

				<p>Также появляется масса дополнительного кода, выполняющего сериализацию и десериализацию данных, передаваемых между сервисами. И хотя обычно его суммарный объём не велик, ничего хорошего в этом нет.</p>
			</li>

			<li><b>Накладные расходы:</b> Все эти разнообразные хранилища данных, преобразования данных и сетевые вызовы не обходятся даром. Лично мне встречалось замедление порядка 1000% из-за перехода на микросервисы (да, в десять раз медленнее).</li>

			<li><b>Сегрегация данных:</b> Поскольку все данные теперь хранятся в разрозненных хранилищах данных, нужно следить за их согласованностью. Если в монолитной системе можно было обойтись простым каскадным удалением, то теперь нужна сложная симфония зависимостей, вызовов и перепроверок. Это очень похоже на использование не реляционного хранилища данных. Если у вас есть опыт работы не реляционными хранилищами и вы успешно с ними справлялись, то проблем возникнуть не должно.</li>
		</ul>

		<h2>4. Критическая оценка</h2>

		<p>Как было показано выше, микросервисы имеют несколько крупных достоинств, но у них так же есть и большие недостатки. С точки зрения размера проекта, достоинством окажется более чёткая архитектура и малая кодовая база каждого из сервисов, но расплатой за это будут сегрегация данных и сложность.</p>

		<p>Небольшие проекты сильно пострадают от накладных расходов. Крупные проекты получат выгоду от увеличения масштабируемости и независимости развёртывания, что позволит более гибко и свободно добавлять вычислительные мощности для обслуживания растущей нагрузки.</p>

		<h2>5. Стоит ли вам использовать микросервисы?</h2>

		<p>Из описанного выше следует, что небольшие проекты не смогут извлечь пользы из микросервисной архитектуры. Однако, они всё же могут извлечь пользу из более чёткой архитектуры и меньшей кодовой базы, верно?</p>

		<p>Не спешите. Ничто не мешает монолитным системам получить эти преимущества, пользуясь достоинствами монолитности. И правда, всё зависит от того, насколько хорошо структурирована архитектура монолитной системы, насколько чётко определены интерфейсы как бы независимых модулей и библиотек. Проблема в том, что для этого нужно соблюдать дисциплину, а с микросервисной архитектурой это получается само собой.</p>

		<p>Поэтому разумно будет задать вопрос себе и своей команде - доверяете ли вы себе настолько мало, что готовы взять на себя бремя развёртывания, аппаратного оснащения и снижения скорости лишь для того, чтобы поделить проект? В большинстве случаев можно поступить по-другому: реализовывать чёткие и строгие интерфейсы для взаимодействия между модулями, создать правила - что разрешено и что и как запрещено вызывать извне модулей, а также использовать инструментарий, который поможет вам в этом.</p>

		<h2>6. Простой способ принятия решения</h2>

		<p>Чтобы помочь вам сориентироваться в лабиринте вопросов и доводов при принятии решения - нужны ли вам микросервисы, я создал соответствующую диаграмму. Вот она:</p>

		<img src="microservices.png" />

		<p>Диаграмма для принятия решений, нужны ли вам микросервисы</p>

		<p>Эта диаграмма ответит на все ваши вопросы о микросервисах.</p>

		<p>Это немного щекотно.</p>

		<h2>7. Заключение</h2>

		<p>Не начинайте с микросервисов, это сложный способ, который вначале не требуется.</p>

		<p>Подведём итоги. Крупнейшее достоинство микросервисной архитектуры, которое трудно получить при других подходах, - это масштабируемость. Все остальные достоинства могут быть достигнуты при соблюдении дисциплины и хорошей организации процесса разработки. К тому же, выбирая монолитный подход, вы получаете надёжность, простоту развёртывания и мониторинга, а также более высокую скорость. Если ваш монолит хорошо спроектирован, его узкие места позднее можно будет выделить в отдельные сервисы, возможно даже переписав их на другой язык, если это потребуется.</p>

		<p>Истинно глаголю вам: не начинайте с микросервисов лишь потому что так делают крутые парни. Это сложный подход, который поначалу не нужен. Наслаждайтесь простотой разработки и гибкостью развёртывания, которые даёт одно приложение. Когда ваш бизнес окрепнет и вырастет, и вы не сможете найти достаточно мощный сервер для приложения, только тогда выделяйте части из общей инфраструктуры в отдельные сервисы, соединяя их через HTTP или через очередь сообщений.</p>

		<p>Принять участие в последующей священной войне можно найдя меня <a href="https://twitter.com/intent/user?screen_name=Stavros">в Twitter</a>. Чтобы избежать невинных жертв, можете просто оставить комментарий на этой странице.</p>

		<h2>8. Примечания переводчика</h2>

		<p>Сам довольно скептически отношусь к идее микросервисов, по многим причинам.</p>

		<p>Во-первых, идея микросервисов основывается на веб-технологиях, но программирование не ограничивается одним только вебом, а за пределами веба имеется более общий подход, который можно назвать "распределённые системы".</p>

		<p>Во-вторых, микросервисный подход уместен в больших компаниях, где работает много программистов, разрабатывающих большие публичные веб-сервисы. Но большинство компаний - не большие и не разрабатывают публичные веб-сервисы. Микросервисные системы в небольших компаниях окажутся не уместными - в таких компаниях нет высоких или непредсказуемо быстро растущих нагрузок, они не могут тратить много денег на оборудование и разработчиков.</p>

		<p>В-третьих, микросервисная архитектура очень напоминает преждевременную оптимизацию, которая, как известно, является злом. Часто люди пытаются сделать своё приложение масштабируемым тогда, когда это ещё не нужно. Автор этой статьи совершенно верно заметил, что при правильно организованной архитектуре приложения, любой из компонентов приложения можно легко превратить в самостоятельный сервис, написав соответствующие прослойки. Поэтому, на мой взгляд, лучше осваивать приёмы из книги банды четырёх, чем поддаваться карго-культу микросервисов.</p>

		<p><a href="mailto:vladimir@stupin.su?subject=Ставрос Корокитакис. Карго-культ микросервисов, 2015">Написать автору перевода</a></p>

		<p><a href="..">&larr;</a></p>
	</body>
</html>
