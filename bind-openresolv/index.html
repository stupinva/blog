<html>
	<head>
		<meta http-equiv="Content-Type" content="plain/html; charset=UTF-8" />
		<link rel="stylesheet" href="../styles.css" type="text/css" />
		<meta name="keywords" content="stretch,bind,debian,linux,pppoe,dns,openresolv,resolvconf,ipoe" />
		<meta name="author" content="Владимир Ступин" />
		<!-- 2018-09-02 -->
		<title>Настройка кэширующего DNS-сервера BIND в связке с openresolv</title>
	</head>
	<body>
		<p><a href="..">&larr;</a></p>

		<h1>Настройка кэширующего DNS-сервера BIND в связке с openresolv</h1>

		<p>Обнаружил, что заметка <a href="../bind-resolvconf/">Настройка кэширующего DNS-сервера BIND в связке с resolvconf</a> в новых релизах Debian больше не работает. Вспомнил об аналоге resolvconf под названием openresolv, который я когда-то нашёл, но воспользоваться которым пока не доводилось. Решил попробовать и openresolv заработал как надо. Спешу поделиться рецептом.</p>

		<p>Первым делом установим openresolv:</p>

		<pre class="console"># apt-get install openresolv</pre>

		<p>Приведём его файл конфигурации /etc/resolvconf.conf к следующему виду:</p>

		<pre class="code">resolv_conf=/etc/resolv.conf
name_servers=127.0.0.1
named_options=/var/run/named/named.options</pre>

		<p>Обновим файлы с DNS-серверами при помощи следующей команды:</p>

		<pre class="console"># resolvconf -u</pre>

		<p>В файле /var/run/named/named.options можно увидеть фрагмент конфигруации BIND, которую можно подключить к основной конфигурации. В моём случае он выглядит следующим образом:</p>

		<pre class="console"># Generated by resolvconf
forward first;
forwarders {
 109.195.144.4;
 5.3.3.3;
 81.30.199.5;
 81.30.199.94;
};</pre>

		<p>Чтобы включить этот фрагмент в конфигурацию BIND, впишем в файл /etc/bind9/named.conf.options одну строчку:</p>

		<pre class="code">include "/var/run/named/named.options";</pre>

		<p>Ещё раз обновим файлы с DNS-серверами при помощи команды:</p>

		<pre class="console"># resolvconf -u</pre>

		<p>В процессе обновления BIND будет автоматически перезапущен, так что в его файл конфигурации будет вписан актуальный список вышестоящих рекурсивных DNS-серверов.</p>

		<p>Список интерфейсов, с которых взяты DNS-серверы, можно узнать при помощи следующей команды:</p>

		<pre class="console"># resolvconf -i</pre>

		<p>В моём случае она вывела такой список:</p>

		<pre class="console">ppp0 vlan3</pre>

		<p>Список DNS-серверов, полученных через эти интерфейсы, можно узнать при помощи такой команды:</p>

		<pre class="console"># resolvconf -l</pre>

		<p>В моём случае вывод был таким:</p>

		<pre class="console"># resolv.conf from ppp0
# Generated by ppp.ip-up for ppp0
nameserver 109.195.144.4
nameserver 5.3.3.3

# resolv.conf from vlan3
# resolv.conf for vlan3
domain ipoe3.ufanet.ru
nameserver 81.30.199.5
nameserver 81.30.199.94</pre>

		<p><a href="mailto:vladimir@stupin.su?subject=Настройка кэширующего DNS-сервера BIND в связке с openresolv">Написать автору</a></p>

		<p><a href="..">&larr;</a></p>
	</body>
</html>
