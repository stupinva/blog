<html>
	<head>
		<meta http-equiv="Content-Type" content="plain/html; charset=UTF-8" />
		<link rel="stylesheet" href="../styles.css" type="text/css" />
		<meta name="keywords" content="getty,перевод,serial,linux,debian" />
		<meta name="author" content="Владимир Ступин" />
		<!-- 2009-09-18 -->
		<title>chantra. Как настроить консоль на последовательном порту в Debian, 2008</title>
	</head>
	<body>
		<p><a href="..">&larr;</a></p>

		<h1>chantra. Как настроить консоль на последовательном порту в Debian, 2008</h1>

		<p>Перевод статьи: <a href="http://www.debuntu.org/how-to-set-up-a-serial-console-on-debian">How-To set up a serial console on Debian</a></p>

		<p>Этот урок проведёт вас через этапы, необходимые для настройки консоли на последовательном порту в Debian Linux.</p>

		<p>Debian использует sysvinit для управления процессом загрузки, среди различных задач которого есть и эта. Существуют некоторые отличия этого урока от большинства уроков, которые вы можете найти в Интернете, описывающих настройку последовательной консоли.</p>

		<p>Последовательная консоль становится необходимой, если она запущена на "безголовом" сервере (то есть не имеющим клавиатуры и экрана) или если вы не можете подключиться к серверу из-за неполадок в сети.</p>

		<p>В этом уроке мы настроим последовательную консоль на сервере, компьютере к которому мы хотим получить доступ. Настройка клиента последовательной консоли описана в другой статье.</p>

		<h2>1. Проверка последовательных устройств</h2>

		<p>Чтобы найти устройства, доступные на компьютере, вы можете запустить:</p>

		<pre class="console">$ dmesg | grep tty
serial8250: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A
serial8250: ttyS1 at I/O 0x2f8 (irq = 3) is a 16550A
00:09: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A
00:0a: ttyS1 at I/O 0x2f8 (irq = 3) is a 16550A</pre>

		<p>Из выведенного можно определить, что имеется два последовательных интерфейса (/dev/ttyS0 и /dev/ttyS1). В этом уроке будем считать, что мы используем первое устройство (ttyS0). Если вы используете второе устройство, вам нужно заменить ttyS0 на ttyS1.</p>

		<h2>2. Настройка последовательной консоли на сервере</h2>

		<p>На сервере мы настроим:</p>

		<ul>
			<li>Последовательную консоль на ttyS0</li>

			<li>Отправку загрузочных сообщений на последовательную консоль</li>

			<li>Заставим Grub выводить сообщения на последовательную консоль</li>
		</ul>

		<h3>2.1. Последовательная консоль</h3>

		<p>Для настройки последовательной консоли нам потребуется отредактировать файл /etc/inittab, чтобы порождать getty на последовательном устройстве. getty позаботится о выводе приглашения для ввода имени пользователя и пароля.</p>

		<p>Отредактируем /etc/inittab и добавим:</p>

		<pre class="code">s0:2345:respawn:/sbin/getty -L 115200 ttyS0 vt102</pre>

		<p>прямо за блоком:</p>

		<pre class="code">1:2345:respawn:/sbin/getty 38400 tty1
2:23:respawn:/sbin/getty 38400 tty2
3:23:respawn:/sbin/getty 38400 tty3
4:23:respawn:/sbin/getty 38400 tty4
5:23:respawn:/sbin/getty 38400 tty5
6:23:respawn:/sbin/getty 38400 tty6</pre>

		<p>Теперь запустим:</p>

		<pre class="console"># init q</pre>

		<p>Чтобы заставить sysvinit перечитать его настройки и породить getty на /dev/ttyS0 .</p>

		<p>Чтобы разрешить вход пользователю root через последовательную консоль, вам нужно отредактировать файл /etc/securetty и проверить, что в нём имеется:</p>

		<pre class="code">ttyS0</pre>

		<h3>2.2. Заставим grub выводить сообщения в ttyS0</h3>

		<p>grub можно настроить на вывод сообщений в последовательную консоль. Отредактируйте меню grub и добавьте:</p>

		<pre class="code">serial --unit=0 --speed=115200 --word=8 --parity=no --stop=1 terminal --timeout=10 serial console</pre>

		<p>В разделе до различных ядер. Это приведёт к тому, что grub будет отображаться на последовательной консоли и вы сможете управлять grub через последовательную консоль или загружаться с использованием другого ядра.</p>

		<p>Если используется ttyS1, замените --unit=0 на --unit=1.</p>

		<p>Также, чтобы сообщения о загрузке выводились на последовательную консоль, вам нужно добавить к строке вашего ядра следующее:</p>

		<pre class="code">console=ttyS0,115200n8 console=tty0</pre>

		<p>Тогда строка ядра будет выглядеть следующим образом:</p>

		<pre class="code">kernel /boot/vmlinuz-2.6.18-6-686 root=/dev/sda1 ro console=ttyS0,115200n8 console=tty0</pre>

		<p>Теперь, при следующей перезагрузке вы сможете подключиться прямо к вашему компьютеру через последовательную консоль!</p>

		<p><a href="mailto:vladimir@stupin.su?subject=Настройка сканера">Написать автору</a></p>

		<p><a href="..">&larr;</a></p>
	</body>
</html>
