<html>
	<head>
		<meta http-equiv="Content-Type" content="plain/html; charset=UTF-8" />
		<link rel="stylesheet" href="../styles.css" type="text/css" />
		<meta name="keywords" content="stretch,X-Window,debian,linux,nouveau,nvidia" />
		<meta name="author" content="Владимир Ступин" />
		<!-- 2019-09-29 -->
		<title>Установка и настройка драйверов nvidia для X-сервера</title>
	</head>
	<body>
		<p><a href="..">&larr;</a></p>

		<h1>Установка и настройка драйверов nvidia для X-сервера</h1>

		<p>Заменил в компьютере одну подержанную устаревшую материнскую плату на другую подержанную, устаревшую чуть менее. На прежней был встроенный видеоконтроллер от Intel, на новой - от Nvidia. Не задумываясь поставил свободный драйвер nouveau, однако столкнулся с проблемами: 1. изображение на экране изредка моргало, как будто кто-то периодически вставляет 25 кадр, 2. компьютер спонтанно зависал, предварительно заливая экран белым цветом в чёрные горизонтальные прерывистые полоски. Стал грешить на видеоконтроллер и его драйвер. Пытался заставить работать драйвер nvidia где-то с полчаса. Попытки увенчались успехом. Пока помнил последовательность настройки, записал всё в блокнот. Теперь из блокнота выбрасываю записи в блог, чтобы в следующий раз не ходить по всем граблям снова.</p>

		<p>Для начала узнаем, видеконтроллер какого из производителей установлен в системе:</p>

		<pre class="console">$ lspci | fgrep VGA
00:0d.0 VGA compatible controller: NVIDIA Corporation C61 [GeForce 7025 / nForce 630a] (rev a2)</pre>

		<p>В нашем случае это встроенный видеоконтроллер NVidia. Чтобы определить, какой драйвер следует использовать с этим видеоконтроллером, установим утилиту nvidia-detect и запустим её:</p>

		<pre class="console"># apt-get install nvidia-detect
# nvidia-detect</pre>

		<p>Утилита должна сообщить имя пакета с драйвером видеоконтроллера. В моём случае это был пакет nvidia-legacy-304xx-driver. Установим этот пакет:</p>

		<pre class="console"># apt-get install --install-recommends nvidia-legacy-304xx-driver</pre>

		<p>После установки пакета с драйвером будет собран модуль ядра, который нужно подгрузить. Сделать это можно при помощи следующей команды:</p>

		<pre class="console"># modprobe nvidia-legacy-304xx</pre>

		<p>Вписываем модуль ядра nvidia-legacy-304xx в файл /etc/modules, чтобы при перезагрузке системы или включении компьютера этот модуль загружался автоматически.</p>

		<p>Также нужно установить поддержку этого драйвера со стороны X-сервера. Для этого ставим пакет с именем xserver-xorg-video-nvidia-legacy-304xx:</p>

		<pre class="console"># apt-get install xserver-xorg-video-nvidia-legacy-304xx</pre>

		<p>Свободный драйвер nouveau в X-сервере имеет более высокий приоритет, чем фирменный драйвер от NVidia. Поэтому, чтобы X-сервер использовал именно фирменный драйвер, нужно удалить из системы пакет, отвечающий за поддержку nouveau со стороны X-сервера:</p>

		<pre class="console"># apt-get remove xserver-xorg-video-nouveau</pre>

		<p>Осталось перезапустить дисплейный менеджер, чтобы он запустил X-сервер, а X-сервер начал использовать новые драйверы. Я пользуюсь дисплейным менеджером lightdm, поэтому в моём случае это можно сделать следующими командами:</p>

		<pre class="console"># systemctl stop lightdm
# systemctl start lightdm</pre>

		<p>По окончании настройки пакет nvidia-detect можно удалить, т.к. вероятность, что он вновь понадобится, довольно мала.</p>

		<pre class="console"># apt-get purge nvidia-detect</pre>

		<p>P.S. Кстати, замена драйвера помогла решить проблему.</p>

		<p><a href="mailto:vladimir@stupin.su?subject=Установка и настройка драйверов nvidia для X-сервера">Написать автору</a></p>

		<p><a href="..">&larr;</a></p>
	</body>
</html>
