<html>
	<head>
		<meta http-equiv="Content-Type" content="plain/html; charset=UTF-8" />
		<link rel="stylesheet" href="../styles.css" type="text/css" />
		<meta name="keywords" content="перевод,docker,dockerfile,linux" />
		<meta name="author" content="Владимир Ступин" />
		<!-- 2017-08-20 -->
		<title>Соня Гамильтон. Заметки о Dockerfile, 2015</title>
	</head>
	<body>
		<p><a href="..">&larr;</a></p>

		<h1>Соня Гамильтон. Заметки о Dockerfile, 2015</h1>

		<p>Перевод статьи: <a href="http://www.snowfrog.net/2015/07/13/dockerfile-notes/">Dockerfile Notes</a></p>

		<p>Автор: Соня Гамильтон (Sonia Hamilton)</p>

		<p>Несколько заметок о Dockerfile'ах Docker.</p>

		<h2>1. Команды</h2>

		<ul>
			<li><b>MAINTAINER</b> - автор, адрес электронной почты и т.п.</li>

			<li><b>FROM</b> - базовый образ, например Ubuntu.</li>

			<li><b>CMD</b> и <b>ENTRYPOINT</b>. Любая из них по отдельности может быть использована для указания исполняемого файла по умолчанию. Если используются обе, то CMD добавляется к ENTRYPOINT для получения командной строки контейнера. Любая из них может быть заменена при запуске docker. Однако CMD легче - она просто берёт остаток команды запуска docker (как "$*" в сценариях оболочки) - разрешая образу docker почувствовать себя в роли выполняемого файла, запущенного через "обёртку".</li>

			<li><b>RUN</b> - установочные команды. В режиме разработки разделите команды RUN, так что слои кэшировались и собирались быстрее. В рабочем режиме лучше воспользоваться цепочкой команд RUN, разделённых знаками &amp;&amp; или точкой с запятой, поскольку несколько отдельных команд RUN создают несколько слоёв.</li>

			<li><b>COPY</b> и <b>ADD</b>. COPY копирует файлы в образ. ADD делает то же самое, но также может разархивировать файл или скачать его по ссылке. Избегайте использования команды ADD, поскольку она обладает излишне сложным поведением.</li>

			<li><b>VOLUME</b> - постоянный каталог на родительской файловой системе внутри /var/lib/docker/volumes. Для получения ожидаемого поведения (общий каталог для родительской системы и контейнера) воспользуйтесь командой docker run -v /var/tmp/foo:/var/tmp/foo.</li>

			<li><b>ENV</b>, <b>WORKDIR</b> и <b>USER</b> - переменные окружения, текущий каталог и идентификатор пользователя для команд CMD/ENTRYPOINT.</li>

			<li><b>EXPOSE</b> - открыть сетевой порт. Воспользуйтесь форматом nn, а не nn:mm, который позволяет пользователю указать публичный порт при помощи опции -p. Порт, открытый при помощи команды EXPOSE может быть автоматически отображён при помощи опции -P.</li>
		</ul>

		<h2>2. Сборка, запуск, выполнение</h2>

		<pre class="code"># Собрать образ и пометить его, использовать текущий каталог в качестве контекста
docker build -t="soniah/foo:1.0" .
# Запустить, автоматически отобразить порты. В режиме разработки опустите -D - стандартный поток
# вывода будет выводиться на экран, а контейнер автоматически остановится при нажатии Ctrl-C.
docker run -P sonia/foo
# Получить интерактивную оболочку
docker exec -it random_name bash
# Удалить все старые образы, за исключением базовых образов Ubuntu
docker rmi -f `docker images | tail -n +2 | grep -v 'ubuntu' | awk {'print $3'}`
# Удалить все контейнеры, включая остановленные контейнеры
docker rm -f `docker ps --no-trunc -aq`</pre>

		<h2>3. Смотрите также</h2>

		<ul>
			<li><a href="http://crosbymichael.com/dockerfile-best-practices.html">Лучшие практики по написанию файлов Dockerfile - МКросби (MCrosby)</a></li>

			<li><a href="https://docs.docker.com/articles/dockerfile_best-practices/">Лучшие практики по написанию файлов Dockerfile</a></li>

			<li><a href="http://www.centurylinklabs.com/dockerfile-entrypoint-vs-cmd/">Файлы Dockerfile: ENTRYPOINT против CMD</a></li>

			<li><a href="http://www.centurylinklabs.com/dockerfile-add-vs-copy/">Файлы Dockerfile: ADD против COPY</a></li>
		</ul>

		<h2>4. Примечания переводчика</h2>

		<p>Искал однажды что-то в интернете и вышел на блог этой авторши. Сейчас уже не помню почему, добавил этот материал в список того, что было бы неплохо перевести. Сейчас смотрю и недоумеваю - зачем мне это понадобилось? Ничего лучше фразы "чтоб было" в голову не пришло. Ну пусть будет.</p>

		<p><a href="mailto:vladimir@stupin.su?subject=Соня Гамильтон. Заметки о Dockerfile, 2015">Написать автору перевода</a></p>

		<p><a href="..">&larr;</a></p>
	</body>
</html>
