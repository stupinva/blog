<html>
	<head>
		<meta http-equiv="Content-Type" content="plain/html; charset=UTF-8" />
		<link rel="stylesheet" href="../styles.css" type="text/css" />
		<meta name="keywords" content="jessie,debian,linux,asterisk,sip,sflphone" />
		<meta name="author" content="Владимир Ступин" />
		<!-- 2016-05-15 -->
		<title>Краткий обзор программного телефона SFLphone</title>
	</head>
	<body>
		<p><a href="..">&larr;</a></p>

		<h1>Краткий обзор программного телефона SFLphone</h1>

		<p>Итак, как я и <a href="../ekiga/">обещал</a>, в этой заметке я сделаю краткий обзор программного телефона SFLphone, который привлёк моё внимание в качестве программы, пригодной для секретарей, диспетчеров и операторов, т.к. умеет работать с несколькими звонками одновременно и соединять абонентов между собой.</p>

		<p>Программа имеет несколько разных интерфейсов и разбита на несколько пакетов:</p>

		<pre class="console">$ apt-cache search sflphone
sflphone-daemon - SIP and IAX2 compatible VoIP phone - core daemon
sflphone-data - SIP and IAX2 compatible VoIP phone - common data
sflphone-evolution - SIP and IAX2 compatible VoIP phone - Evolution plugin
sflphone-gnome - SIP and IAX2 compatible VoIP phone - GNOME client
sflphone-kde - SIP and IAX2 compatible VoIP phone - KDE client</pre>

		<p>Как видно, имеются варианты интерфейсов для рабочих сред KDE и GNOME, а также плагин для почтового клиента Evolution. Ещё два пакета содержат демон и данные для программы. Демон на самом деле и является программным телефоном: внутри него происходит работа с устройствами компьютера и сетью. Интерфейс программы взаимодействует с демоном через DBUS и занимается лишь передачей команд в демон и отображением его состояния. В этой заметке я рассмотрю только интерфейс для среди GNOME. Установим в систему соответствующий пакет:</p>

		<pre class="console"># apt-get install sflphone-gnome</pre>

		<p>Общий вид программы:</p>

		<img src="sflphone_main.png" />

		<p>Под меню видно имеется окно со списком текущих разговоров, ниже - регуляторы громкости для микрофона и наушников, ещё ниже - номеронабиратель. Справочник контактов спрятан в отдельное окно, что мне показалось несколько неудобным.</p>

		<p>Чтобы попасть в настройки программы, нужно выбрать пункт меню "Правка", а в раскрывшемся списке выбрать пункт "Настройки":</p>

		<img src="sflphone_settings.png" />

		<p>Из всех имеющихся настроек особенный интерес представляют настройки звука:</p>

		<img src="sflphone_settings_audio.png" />

		<p>Здесь можно выбрать аудиоустройства, которые будут использоваться для озвучивания поступившего звонка, для озвучивания речи собеседника, а также микрофон, который будет использоваться для отправки речи собеседнику.</p>

		<p>Второй интересный пункт, это выбор видеоустройств:</p>

		<img src="sflphone_settings_video.png" />

		<p>К сожалению, совершить видеозвонок с использованием этого программного телефона мне не удалось. Но это, наверное, не столь важно для рабочего места секретаря.</p>

		<p>Чтобы настроить учётные записи, нужно в основном окне программы выбрать пункт "Правка", а в раскрывшемся списке выбрать пункт "Аккаунты":</p>

		<img src="sflphone_menu_accounts.png" />

		<p>После этого откроется список учётных записей:</p>

		<img src="sflphone_accounts.png" />

		<p>Здесь имеется отдельная учётная запись под названием "IP2IP". В ней хранятся настройки, которые будут использоваться для прямых вызовов, без использования какой-либо учётной записи. Можно добавлять, удалять и редактировать учётные записи, а также временно отключать их, снимая галочку.</p>

		<p>Во вкладке редактирования основных настроек учётной записи можно указать имя пользователя, пароль, адрес сервера или SIP-прокси и псевдоним, который будет отображаться в списке учётных записей и на программных телефонах других абонентов:</p>

		<img src="sflphone_account_common.png" />

		<p>Во вкладке аудионастроек можно выбрать используемые кодеки, их приоритеты, звук входящего звонка и режим передачи тоновых сигналов:</p>

		<img src="sflphone_account_audio.png" />

		<p>Во вкладке видеонастроек аналогично, можно выбрать используемые кодеки и их приоритеты, а также включить или выключить использование видео:</p>

		<img src="sflphone_account_video.png" />

		<p>Ещё раз скажу, что совершить видеозвонок при использовании этой программы мне не удалось.</p>

		<p>Во вкладке дополнительных настроек можно указать номер используемого UDP-порта, внешний IP-адрес и указать STUN-сервер:</p>

		<img src="sflphone_account_additional.png" />

		<p>В отличие от Ekiga, тут все настройки легко доступны и их можно настраивать для каждой учётной записи отдельно.</p>

		<p>В последней вкладке можно указать настройки шифрования для сеансов SIP и для трафика RTP:</p>

		<img src="sflphone_account_encryption.png" />

		<p>Я ни то ни другое настраивать пока не пробовал.</p>

		<p>Теперь перейдём к самому интересному - к соединению абонентов друг с другом.</p>

		<p>Вот так входящий звонок отображается в правом верхнем углу экрана:</p>

		<img src="sflphone_incoming1.png" />

		<p>Принят звонок можно щелчком по этому всплывающему окну.</p>

		<p>Тот же звонок отображается в списке разговоров. Взять трубку можно либо нажатием на пиктограмму с телефонной трубкой и зелёной стрелкой, либо через меню "Вызов", либо сочетанием горячих клавиш, либо через контекстное меню, как это показано ниже:</p>

		<img src="sflphone_incoming.png" />

		<p>Предположим, что в процессе разговора выясняется, что звонящего нужно переключить на специалиста, который более компетентен в обсуждаемом вопросе.</p>

		<p>Ставим входящий звонок на паузу:</p>

		<img src="sflphone_pause.png" />

		<p>Опять же - поставить на паузу можно сочетанием горячих клавиш, либо через меню "Вызов".</p>

		<p>Стоящий в очереди звонок отображается следующим образом:</p>

		<img src="sflphone_paused.png" />

		<p>При этом телефонная станция воспроизводит ожидающему абоненту музыку.</p>

		<p>Пока звонок стоит в очереди, совершаем исходящий звонок:</p>

		<img src="sflphone_outgouing.png" />

		<p>Этот же исходящий звонок будет отображаться всплывающей надписью в правом верхнем углу экрана:</p>

		<img src="sflphone_outgouing1.png" />

		<p>Дозвонившись до специалиста, объясняем ему суть вопроса, который обсуждался с ожидающим абонентом и предлагаем им поговорить друг с другом.</p>

		<p>Соединение абонентов друг с другом:</p>

		<img src="sflphone_transfer.png" />

		<p>После соединения абонентов друг с другом, оба звонка исчезают из списка в программе и продолжают общаться между собой уже без нашего участия.</p>

		<p>Как вы заметили, кроме передачи звонка другому абоненту, имеется ещё возможность создать конференцию. Во отличие от соединения двух абонентов между собой, когда соединённые звонки пропадают из списка, конференция остаётся в списке. Конференция поддерживается самим демоном sflphone, при этом не используются функции конференций Asterisk. Выглядит конференция следующим образом:</p>

		<img src="sflphone_conference.png" />

		<p>Управляет конференцией абонент, использующий sflphone. Он может поставить конференцию на паузу, в таком случае все абоненты будут находиться в режиме ожидания и слушать музыку. Когда от конференции отключается абонент sflphone, конференция уничтожается, а все другие абоненты отключаются от неё.</p>

		<p>В процессе использования перенаправлений звонков обнаружил, что телефонные шлюзы Cisco ATA 186 не поддерживают функцию REINVITE, которая позволяет абоненту с другой стороны попросить согласовать параметры звука с другим абонентом. Именно эта опция используется для перенаправления звонков. На случай подобных телефонных шлюзов в Asterisk имеется опция canreinvite. Чтобы указать, что телефонный шлюз не умеет переключаться на другого абонента, нужно указать в настройках SIP-пользователя опцию canreinvite=no. В этом случае Asterisk будет выступать посредником при трансляции звука. При установлении первого сеанса звук от обоих абонентов будет проходить через Asterisk. Когда нужно будет выполнить переключение, Aterisk самостоятельно выполнит REINVITE с одним из абонентов, продолжая трансляцию звука через себя для другого абонента, который не поддерживает REINVITE.</p>

		<p><a href="mailto:vladimir@stupin.su?subject=Краткий обзор программного телефона SFLphone">Написать автору</a></p>

		<p><a href="..">&larr;</a></p>
	</body>
</html>
