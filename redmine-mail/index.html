<html>
	<head>
		<meta http-equiv="Content-Type" content="plain/html; charset=UTF-8" />
		<link rel="stylesheet" href="../styles.css" type="text/css" />
		<meta name="keywords" content="redmine,wheezy,linux,debian" />
		<meta name="author" content="Владимир Ступин" />
		<!-- 2014-10-05 -->
		<title>Настройка почты в Redmine, обновление структуры базы данных</title>
	</head>
	<body>
		<p><a href="..">&larr;</a></p>

		<h1>Настройка почты в Redmine, обновление структуры базы данных</h1>

		<h2>1. Настройка почты</h2>

		<p>Для отправки уведомлений об изменении в задачах заинтересованным лицам, в каталоге с настройками Redmine можно создать файл /etc/redmine/default/configuration.yml следующего вида:</p>

		<pre class="code">production:
  email_delivery:
    delivery_method: :smtp
    smtp_settings:
      address: mail.domain.tld
      port: 587
      domain: domain.tld
      authentication: :login
      user_name: redmine@domain.tld
      password: uxai5eikahf2Ik8H</pre>

		<p>Смысл настроек понятен из их названия. Существует ещё возможность отправлять почту при помощи локальной команды sendmail. Подробнее о настройках отправки почты можно почитать здесь: <a href="http://www.redmine.org/projects/redmine/wiki/RusEmailConfiguration">Настройка почты</a></p>

		<p>Теперь нужно перезапустить redmine, чтобы он заново прочитал файлы конфигурации:</p>

		<pre class="console"># /etc/init.d/uwsgi restart redmine</pre>

		<p>Теперь нужно зайти в Redmine, перейти в раздел "Администрирование" -&gt; "Настройки":</p>

		<img src="mail1.png" />

		<p>Во вкладке "Общие" поправить поле "Имя компьютера", указав веб-адрес, по которому доступен Redmine, но без протокола и без косых черт слева и справа:</p>

		<img src="mail2.png" />

		<p>Во вкладке "Уведомления по email" нужно выбрать события, уведомления о которых нужно отсылать, указать адрес, с которого будут отправляться письма:</p>

		<img src="mail4.png" />

		<p>Там же можно указать заголовок письма и текст, который будет добавлен ниже тела письма (обычно там пишут про то, что на сообщение не нужно отвечать, что оно сгенерировано автоматически, почему оно пришло адресату или как отписаться от писем).</p>

		<p>Адреса пользователей можно редактировать в их профилях.</p>

		<h2>2. Обновление структуры базы данных</h2>

		<p>Если у вас имеется база данных от старой версии Redmine, которую вы хотите развернуть на более свежей версии Redmine, то обновить структуру базы данных до более свежей версии очень просто:</p>

		<pre class="console"># cd /usr/share/redmine
# rake db:migrate RAILS_ENV=production X_DEBIAN_SITEID=support</pre>

		<p>В Debian существует возможность легко запустить на одном компьютере несколько разных экземпляров Redmine. В переменной X_DEBIAN_SITEID можно указать имя экземпляра Redmine. Имя экземпляра задаёт имя подкаталога в каталоге /etc/redmine/. В подкаталоге экземпляра находятся файлы с настройками Redmine. Если имя экземпляра не указывать, то подразумевается экземпляр default и используются настройки из каталога /etc/redmine/default/.</p>

		<p>В Debian даже есть возможность управлять созданием и удалением экземпляров Redmine при помощи мастера, которого можно запустить по команде dpkg-reconfigure redmine. Но я предостерегаю им пользоваться, т.к. при создании нового экземпляра он удаляет настройки уже существующего, не обращая внимания на ваш ответ о том, что вы не хотите это делать.</p>

		<p><a href="mailto:vladimir@stupin.su?subject=Настройка почты в Redmine, обновление структуры базы данных">Написать автору</a></p>

		<p><a href="..">&larr;</a></p>
	</body>
</html>
