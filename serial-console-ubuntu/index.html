<html>
	<head>
		<meta http-equiv="Content-Type" content="plain/html; charset=UTF-8" />
		<link rel="stylesheet" href="../styles.css" type="text/css" />
		<meta name="keywords" content="перевод, getty,ubuntu,serial,linux" />
		<meta name="author" content="Владимир Ступин" />
		<!-- 2009-09-18 -->
		<title>chantra. Как настроить консоль на последовательном порту в Ubuntu, 2008</title>
	</head>
	<body>
		<p><a href="..">&larr;</a></p>

		<h1>chantra. Как настроить консоль на последовательном порту в Ubuntu, 2008</h1>

		<p>Перевод статьи: <a href="http://www.debuntu.org/how-to-set-up-a-serial-console-on-ubuntu">How-To set up a serial console on Ubuntu</a></p>

		<p>Этот урок проведёт вас через этапы, необходимые для настройки консоли на последовательном порту в Ubuntu Linux.</p>

		<p>В отличие от других дистрибутивов, Ubuntu использует upstart вместо sysvinit и поэтому есть некоторые отличия этого урока от большинства уроков, которые вы можете найти в Интернете, описывающих настройку последовательной консоли.</p>

		<p>Последовательная консоль становится необходимой, если она запущена на "безголовом" сервере (то есть не имеющим клавиатуры и экрана) или если вы не можете подключиться к серверу из-за неполадок в сети.</p>

		<p>В этом уроке мы настроим последовательную консоль на сервере, компьютере к которому мы хотим получить доступ. Настройка клиента последовательной консоли описана в другой статье.</p>

		<h2>1. Проверка последовательных устройств</h2>

		<p>Чтобы найти устройства, доступные на компьютере, вы можете запустить:</p>

		<pre class="console">$ dmesg | grep tty
serial8250: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A
00:0c: ttyS0 at I/O 0x3f8 (irq = 4) is a 16550A</pre>

		<p>Из выведенного можно определить, что имеется один последовательный интерфейс (/dev/ttyS0). Возможно на вашем компьютере будет более одного интерфейса. В этом уроке будем считать, что мы используем первое устройство (ttyS0). Если вы используете второе устройство, вам нужно заменить ttyS0 на ttyS1.</p>

		<h2>2. Настройка последовательной консоли на сервере</h2>

		<p>На сервере мы настроим:</p>

		<ul>
			<li>Последовательную консоль на ttyS0</li>

			<li>Отправку загрузочных сообщений на последовательную консоль</li>

			<li>Заставим Grub выводить сообщения на последовательную консоль</li>
		</ul>

		<h3>2.1. Последовательная консоль</h3>

		<p>Для настройки последовательной консоли нам потребуется создать новый файл /etc/event.d/ttyS0, чтобы порождать getty на последовательном устройстве. getty позаботится о выводе приглашения для ввода имени пользователя и пароля.</p>

		<p>Отредактируем /etc/event.d/ttyS0 и добавим:</p>

		<pre class="code"># ttyS0 - getty
#
# Служба сопровождает getty на ttyS0 начиная с момента
# запуска системы и до её остановки.
start on runlevel 2
start on runlevel 3
start on runlevel 4
start on runlevel 5
stop on runlevel 0
stop on runlevel 1
stop on runlevel 6
respawn
exec /sbin/getty -L 115200 ttyS0 vt102</pre>

		<p>Чтобы разрешить вход пользователю root (если вы включили учётную запись пользователя root на вашем компьютере) через последовательную консоль, вам нужно отредактировать файл /etc/securetty и добавить:</p>

		<pre class="code">ttyS0</pre>

		<h3>2.2. Заставим grub выводить сообщения в ttyS0</h3>

		<p>grub можно настроить на вывод сообщений в последовательную консоль. Отредактируйте меню grub и добавьте:</p>

		<pre class="code">serial --unit=0 --speed=115200 --word=8 --parity=no --stop=1
terminal --timeout=10 serial console</pre>

		<p>В разделе до различных ядер. Это приведёт к тому, что grub будет отображаться на последовательной консоли и вы сможете управлять grub через последовательную консоль или загружаться с использованием другого ядра.</p>

		<p>Если используется ttyS1, замените --unit=0 на --unit=1.</p>

		<p>Также, чтобы сообщения о загрузке выводились на последовательную консоль, вам нужно добавить к строке вашего ядра следующее:</p>

		<pre class="code">console=ttyS0,115200n8 console=tty0</pre>

		<p>Тогда строка ядра будет выглядеть следующим образом:</p>

		<pre class="code">kernel /boot/vmlinuz-2.6.24-16-generic root=UUID=uuuuuu-iii3-dddd-uuuu-iiiiiddddd ro quiet splash console=ttyS0,115200n8 console=tty0</pre>

		<p>Теперь, при следующей перезагрузке вы сможете подключиться прямо к вашему компьютеру через последовательную консоль!</p>

		<p><a href="mailto:vladimir@stupin.su?subject=chantra. Как настроить консоль на последовательном порту в Ubuntu, 2008">Написать автору перевода</a></p>

		<p><a href="..">&larr;</a></p>
	</body>
</html>
